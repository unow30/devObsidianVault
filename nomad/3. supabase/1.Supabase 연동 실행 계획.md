## 질문
### 현재 환경 상태

#### ✅ 완료된 항목
- Docker로 로컬 Supabase 컨테이너 실행 중 (API URL: `http://127.0.0.1:54321`, Studio: `http://127.0.0.1:54323`).
- 초기 마이그레이션 `00000000000000_initial_schema.sql` 적용 완료.
- 시드 데이터: `cities` 테이블에 15개 도시 데이터 삽입 완료.
- TypeScript 타입 파일 `types/database.types.ts` 생성 완료.

***

### Step 1: `.env.local` 파일 생성

로컬 개발용 환경변수 파일을 프로젝트 루트에 생성하고, Next.js가 `.env`보다 `.env.local`을 우선 적용하도록 설정한다.

```bash
# ./env.local (또는 .env.local)
# 로컬 Supabase 설정 (supabase start 출력값 기반)
NEXT_PUBLIC_SUPABASE_URL=http://127.0.0.1:54321
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_DEFAULT_KEY=sb_publishable___ooooo
```

- 기존 `.env`는 그대로 유지하여 프로덕션 값을 보존한다.

***

### Step 2: `.gitignore`에서 `.env.local` 제외 확인

- `.gitignore`에 아래 항목이 포함되어 있는지 확인한다.

```gitignore
.env.local
.env*.local
```

- 포함되어 있지 않다면 추가하여 민감 정보가 원격 저장소에 커밋되지 않도록 한다.[7]

***

### Step 3: 개발 서버 실행 및 연결 테스트

- 개발 서버 실행:  

```bash
npm run dev
```

- 브라우저에서 접속: `http://localhost:3000`
- 브라우저 콘솔 및 터미널 로그에서 Supabase 클라이언트 초기화 및 연결 관련 에러가 없는지 확인한다.

***

### Step 4: Supabase Studio에서 데이터 확인

- Studio 접속: `http://127.0.0.1:54323`
- Table Editor에서 다음 항목 확인:
  - `cities` 테이블에 15개 시드 데이터가 존재하는지 확인.
  - `profiles` 테이블 구조(컬럼, 타입, PK/FK 등)가 의도한 스키마와 일치하는지 확인.

***

### Step 5: 연결 검증 테스트 (MCP 도구)

- MCP 도구(또는 준비된 스크립트/CLI)를 사용해 Supabase에 접속한다.
- `cities` 테이블에 대해 `select * from cities limit 5` 수준의 조회를 수행하여:
  - 쿼리가 성공적으로 수행되는지.
  - 반환 데이터가 Studio에서 보이는 데이터와 일치하는지 확인한다.

***

### 검증 체크리스트

- Docker 실행 중 (Supabase 관련 컨테이너 모두 Healthy 상태).
- `npm run supabase:start` 또는 `supabase start` 성공적으로 완료.
- 초기 마이그레이션이 적용되어 스키마가 최신 상태.
- 시드 데이터가 `cities` 테이블에 삽입 완료.
- `types/database.types.ts`가 생성되어 타입 안전한 쿼리 가능.
- `.env.local` 파일 생성 및 올바른 값(Supabase URL, publishable key) 설정.
- `npm run dev`가 에러 없이 실행되고, 빌드/런타임 환경변수 로딩에 문제가 없음.
- 브라우저에서 Supabase 연결 관련 콘솔 에러가 없음.

***

### 다음 단계 (환경 검증 완료 후)

SUPABASE-SPEC.md에 따라 실제 기능 연동을 진행한다.

1. **Header.tsx 수정**  
   - 기존 Mock user 제거.  
   - Supabase Auth를 통해 실제 로그인 사용자 정보를 조회하도록 수정.

2. **도시 데이터 연동**  
   - `lib/mock-data.ts`에서 사용하던 하드코딩/모킹 데이터 제거.  
   - Supabase 클라이언트로 `cities` 테이블을 조회하는 쿼리로 대체.

3. **API 엔드포인트 구현**  
   - Next.js API Route 또는 Route Handler를 사용해 필터링/정렬을 지원하는 엔드포인트 구현.  
   - Supabase 쿼리에서 `order`, `eq`, `ilike` 등을 활용해 조건/정렬 처리.

4. **사용자 상호작용 기능**  
   - 좋아요/싫어요, 리뷰 테이블 설계 및 마이그레이션 추가.
   - 해당 테이블과 `profiles`/`cities` 간 관계를 설정하고, Supabase Auth 사용자 ID를 FK로 활용.

***

### 파일 변경 목록

| 파일           | 작업 내용                       |
| ------------ | --------------------------- |
| `.env.local` | 신규 생성 (로컬 Supabase 환경변수 설정) |

---


---
## 연동 결과
### Supabase 로컬 연동 완료 확인

로컬 Supabase 연동이 모든 체크리스트를 통과하며 성공적으로 완료되었습니다. 개발 서버(http://localhost:3001)에서 REST API를 통해 도시 데이터 조회까지 확인되어 다음 단계로 안전하게 진행할 수 있습니다.

### 완료된 항목 상세

| 항목             | 상태                                      |
|------------------|-------------------------------------------|
| 로컬 Supabase 실행 | ✅ http://127.0.0.1:54321                  |
| 마이그레이션 적용 | ✅ cities, profiles 테이블 생성            |
| 시드 데이터       | ✅ 15개 도시 데이터 삽입                   |
| TypeScript 타입   | ✅ types/database.types.ts 생성            |
| .env.local 생성   | ✅ 로컬 환경변수(Supabase URL, Key) 설정   |
| 개발 서버        | ✅ http://localhost:3001 실행 중            |
| REST API 연결     | ✅ 도시 데이터 조회 성공                   |

추가 접속 정보: Supabase Studio(http://127.0.0.1:54323), Mailpit 이메일 테스트(http://127.0.0.1:54324).

### 다음 단계 실행 계획

SUPABASE-SPEC.md에 따라 기능 구현을 순차적으로 진행합니다. 각 단계에서 Supabase 클라이언트와 타입을 활용해 타입 안전한 코드를 작성하세요.

#### 1. Header.tsx 수정 (우선순위 1)
- Mock user 데이터 제거.
- Supabase Auth `getSession()` 또는 `getUser()`를 사용해 실제 사용자 정보 조회.
- 로그인 상태에 따라 UI 업데이트 (예: 프로필 표시 또는 로그인 버튼).

#### 2. 도시 데이터 연동
- 기존 mock-data.ts에서 Supabase 쿼리로 전환.
- `supabase.from('cities').select('*')`로 데이터 페칭.
- React Query 또는 SWR로 캐싱 적용 권장.

#### 3. API 엔드포인트 구현
- `/api/cities` Route Handler 생성.
- 쿼리 파라미터로 필터링(예: `?country=KR`), 정렬(`?sort=name`) 지원.
- Row Level Security(RLS) 활성화하여 인증된 사용자만 접근.

#### 4. 사용자 상호작용 기능
- `likes`, `reviews` 테이블 마이그레이션 추가.
- 좋아요/싫어요: `supabase.from('likes').upsert()` 사용.
- 리뷰: 텍스트 입력 후 `profiles.user_id`와 연동해 삽입.

### 구현 팁 및 주의사항

- Supabase 클라이언트 초기화: `createClient(NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY)`.
- Auth 세션 관리: Next.js Middleware 또는 Server Components에서 `cookies().get('sb-access-token')` 활용.
- RLS 정책: Studio에서 `cities` 테이블에 `select` 정책 적용 (인증된 사용자만).
- 타입 활용: `Database['public']['Tables']['cities']['Row']`로 응답 타입 지정.
- 테스트: 개발 서버 재시작 후 브라우저 콘솔/네트워크 탭으로 쿼리 확인.