## **🚀 PM2란?**
- **PM2**는 **Node.js 애플리케이션을 관리하는 프로세스 매니저**입니다.
- 애플리케이션을 자동으로 재시작하고, 로드 밸런싱을 지원하며, 로그 관리를 제공하여 **운영 환경에서 안정적으로 실행**할 수 있도록 도와줍니다.
## **🔹 PM2의 주요 기능**
### **1️⃣ 애플리케이션 자동 재시작**
- 애플리케이션이 예기치 않게 종료되면 **자동으로 다시 실행**
- watch 모드를 사용하면 코드 변경 시 자동 재시작 가능
### **2️⃣ 백그라운드 실행 (Daemon Mode)**
- 터미널을 닫아도 애플리케이션이 계속 실행됨
- 시스템 재부팅 후에도 애플리케이션 자동 실행 가능
### **3️⃣ 로드 밸런싱 (Cluster Mode)**
-  여러 개의 CPU 코어를 활용하여 성능 최적화
- 동일한 애플리케이션을 여러 개의 인스턴스로 실행
### **4️⃣ 실시간 로깅 및 모니터링**
- pm2 logs로 애플리케이션 로그 확인 가능
- pm2 monit로 CPU 사용량, 메모리 사용량 모니터링 가능
### **5️⃣ 환경변수 설정 및 관리**
- .env 파일 없이 PM2에서 직접 환경변수 설정 가능
- 환경별(개발, 테스트, 운영) 설정 관리 가능
### **6️⃣ 프로세스 관리 및 제어**
- 애플리케이션 시작, 중지, 재시작, 삭제, 리스트 보기 등의 기능 제공

## **🔹 PM2 설치 방법**
### **1️⃣ PM2 설치**

```
npm install -g pm2
```

### **2️⃣ Node.js 애플리케이션 실행**

```
pm2 start app.js
```

### **3️⃣ 실행 중인 프로세스 확인**

```
pm2 list
```

### **4️⃣ 애플리케이션 재시작 / 중지 / 삭제**

```
pm2 restart app
pm2 stop app
pm2 delete app
```

### **5️⃣ 시스템 재부팅 후 자동 실행**

```
pm2 startup
pm2 save
```

## **🔹 PM2 실행 모드**

### **1️⃣ 기본 실행 (Fork Mode)**

• 기본적으로 하나의 프로세스를 실행
• 단일 스레드 애플리케이션에 적합

```
pm2 start app.js
```

### **2️⃣ 클러스터 모드 (Cluster Mode)**

• 멀티 코어를 활용하여 여러 개의 인스턴스를 실행
• 성능 최적화에 유리

```
pm2 start app.js -i max
```

👉 -i max : 사용 가능한 모든 CPU 코어를 활용하여 실행

## **🔹 PM2의 주요 명령어 정리**

| **명령어**          | **설명**             |
| ---------------- | ------------------ |
| pm2 start app.js | 애플리케이션 실행          |
| pm2 list         | 실행 중인 프로세스 목록 확인   |
| pm2 restart app  | 애플리케이션 재시작         |
| pm2 stop app     | 애플리케이션 중지          |
| pm2 delete app   | 애플리케이션 삭제          |
| pm2 logs         | 실시간 로그 확인          |
| pm2 monit        | CPU, 메모리 사용량 모니터링  |
| pm2 save         | 현재 실행 중인 프로세스를 저장  |
| pm2 startup      | 시스템 재부팅 후 자동 실행 설정 |

## **🔹 PM2 환경 설정 (Ecosystem File)**
- PM2는 JSON 또는 JS 형식의 **Ecosystem 파일**을 사용하여 환경변수 및 설정을 관리할 수 있습니다.
### **1️⃣ Ecosystem 파일 생성**

```
pm2 ecosystem
```

### **2️⃣ ecosystem.config.js 파일 예제**
- 1번 방법 대신 직접 파일을 프로젝트 루트폴더에 생성할 수 있다.

```
module.exports = {
  apps: [
    {
      name: "my-app",
      script: "./app.js",
      instances: "max",
      exec_mode: "cluster",
      watch: true,
      env: {
        NODE_ENV: "development",
      },
      env_production: {
        NODE_ENV: "production",
      }
    }
  ]
};
```

### **3️⃣ Ecosystem 파일을 사용하여 실행**

```
pm2 start ecosystem.config.js --env production
```

**🎯 PM2를 사용해야 하는 이유**


✅ **애플리케이션이 죽어도 자동으로 재시작됨**

✅ **터미널을 닫아도 백그라운드에서 실행 가능**

✅ **여러 개의 프로세스를 동시에 실행하여 성능 향상**

✅ **실시간 로그 및 모니터링 제공**

✅ **시스템 재부팅 후에도 애플리케이션 자동 실행**
